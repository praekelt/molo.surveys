{% extends 'base.html' %}

{% load i18n %}
{% load wagtailcore_tags wagtailimages_tags core_tags static %}

{% block content %}
<div class="surveys surveys{{page.get_parent_section.get_effective_extra_style_hints}}">
  <h1 class="surveys__title">{{ page.title }}</h1>
  <h4 class="surveys__intro">{{ page.intro }}</h4>
  {% if page.image %}
    {% image page.image width-98 as tmp_photo_small %}
    {% image page.image width-320 as tmp_photo_large %}
     <img src="{{ tmp_photo_small.url }}" srcset="{{ tmp_photo_large.url }}" alt="{{ self.get_effective_image.title }}" class="feature-image" />
  {% endif %}
  <div class="surveys--inner-content">
  {% for block in page.content %}
      {% if block.block_type == 'heading' %}
      <h1 class="heading">
        {{ block.value }}
      </h1>
      {% elif block.block_type == 'image' %}
        {% image block.value width-240 %}
      {% elif block.block_type == 'numbered_list' %}
        <ol>
        {% for item in block.value %}
          <li>{{ item|handle_markdown }}</li>
        {% endfor %}
        </ol>
      {% elif block.block_type == 'list' %}
        <ul>
        {% for item in block.value %}
          <li>{{ item|handle_markdown }}</li>
        {% endfor %}
      </ul>
      {% else %}
          {{ block }}
      {% endif %}
  {% endfor %}
  </div>
  {% if user.is_authenticated and user.is_active or request.is_preview or self.allow_anonymous_submissions %}
    {% if form %}
      <form class="surveys__form" action="{% pageurl self %}{% if self.multi_step %}?p={{ fields_step.number|add:"1" }}{% endif %}" method="post">
        {% csrf_token %}
        {% for field in form %}
          <fieldset>
            <label for="{{ field.id_for_label }}">{{ field.label }}</label>
            <span class="surveys__helptext">{{ field.help_text }}</span>
            {{ field }}
            {% if field.errors %}
              <ul class="error error--surveys">
              {% for error in field.errors %}
                <li>{{ error }}</li>
              {% endfor %}
              </ul>
            {% endif %}
          </fieldset>
        {% endfor %}
        {% trans "Submit Survey" as text %}
        <input type="submit" value="{% if is_intermediate_step %}{% trans 'Next Question' %}{% else %}{{self.submit_text|default:text }}{% endif %}" />

      </form>
    {% else %}
      <p class="error error--surveys">{% trans 'You have already completed this survey.' %}</p>
      <div class="call-to-action call-to-action--surveys">
        <a href="{{request.site.root_page.url}}" class="call-to-action__nav-item call-to-action__nav-item--back-home">
        {% trans "Back to Home page" %}</a>
      </div>
    {% endif %}
  {% else %}
    <div class="call-to-action call-to-action--surveys">
      <a href="{% url 'molo.profiles:auth_login' %}?next={{request.path}}" class="call-to-action__nav-item call-to-action__nav-item--surveys">{% trans 'Please log in to take this survey' %}</a>
    </div>
  {% endif %}
</div>
{% endblock %}

